# **instruction**

- 数据传输
- 建立云服务器平台

---

## *1.数据传输*

由于数据传输量较大，想要实现实时的自动化检测，就需要改造一个适合（轻）量化传输数据的传输途径

- 数据的轻量化
  - 市面上数据轻量化平台存在的问题
  - 使用三级递进缓存优化加载速度
  - 选择性加载优化加载速度
  - 数模精分处理实现高速高效传输
- 轻量化系统配置
  - 部署服务器系统
  - 安装轻量化处理程序
  - 发布网络站点

---

### [1] 数据的轻量化

#### 市面上数据轻量化平台存在的问题

> 目前市面上的轻量化平台全部采用二级缓存，缓存无选择性，能否流畅查看模型完全依赖良好的网络环境，首次加载时间长，加载进程的大部分时间是从无到有的过程，用户查看体验差。本方案基于传统轻量化技术，创新采用三级递进缓存，选择性加载方式与数模精细分离处理等创新技术，在确保不丢失模型数据的前提下，将重量级的“大”模型，转化成可以快速加载和方便查看的轻量级“小”模型，实现将BIM轻量化模型在网页端和客户端的多段快速缓冲加载。

#### 三级递进缓存优化加载速度

> 一级缓存即进程每次加载时都需从数据库中获取；二级缓存时，两次缓存需执行一次数据库操作，第二次查询并获取。基于5D模型数据的特点，通过两级缓存加载可视化几何数据，通过第三级缓存加载非直观几何数据与属性参数、进度与成本数据，减少首次与二次缓存负担，加快加载显示速度，几乎可以达到加载即可见的程度。

#### 选择性加载优化加载速度

> 根据进程读取顺序，绝大多数的请求首先落在一级缓存上，而一级缓存也是限制加载时间的最主要原因，所以在一级缓存开始加载之前，会出现选项，可以选择显示方式，显示精度与需要加载的构件，用户可以自定义选择，系统根据选项加载缓存，即满足用户的需求，又可以保证快速的加载。

#### 数模精分处理实现高速高效传输

> 利用专业BIM软件创建的模型包括几何数据和模型信息，几何数据即3D模型，模型信息包括模型的结构层级与关系数据，构件属性等。基于5D模型数据的特点，模型信息除了常规的数据，还包括时间维度的进度信息与成本维度的工程信息。所以轻量化系统需要首先将几何数据和模型信息分离，然后运用不同的技术分别压缩数据，以达到整体轻量化的效果。

---

### [2] 轻量化系统配置

#### 部署服务器系统

> IIS是一种Web服务组件，采用轻量化引擎与BIM系统安装在同一服务器的模式，服务器操作系统为Windows Server 2012。SQL为结构化查询语言，为了将数据库中的数据容易发布到Web页面，安装Microsoft的关系数据库管理系统SQL Server，增加对Web技术的支持。

#### 安装轻量化处理程序

> 首先,安装引擎运行环境，包括ASP.NET MVC 4与VC运行库vcredist＿x64.exe、vcredist＿x86.exe。其次安装轻量化引擎工具包，使用的是WebGL轻量化BIM引擎，解压ModelAirToolInit.rar，运行Setup.Bat。然后设置BIM应用系统，轻量化BIM引擎基于多家BIM软件开发，使用不同格式的模型，需要安装相应的BIM软件。

#### 发布网络站点

> 通过IIS管理器添加Demo程序站点，将轻量化引擎Demo发布成可访问的站点，名称与端口可自定义，物理路径为“NetBimEngineDemo”所在路径。将所获取的BIM轻量化引擎授权文件替换Demo程序中原有的授权文件，使Demo程序定制为本系统所用，确保程序能够正常进行轻量化BIM模型操作。

---

## *2. 建立云服务器平台*

- 服务器的选取（选择阿里云服务器）
  - 注册阿里云账号，[登录](https://account.aliyun.com/login/login.htm?oauth_callback=https%3A%2F%2Fecs.console.aliyun.com%2F%3Fspm%3D5176.doc25416.2.2.OVBjYl#/home)阿里云服务器管理控制台
  - 选择**云服务器ESC - 实例 - 创建实例**，进入创建实例界面
  - 在创建实例页面选择服务器的各种配置，其中，系统**镜像**选择“**Windows Server 2012 R2 数据中心版 64位中文版**”，带宽选择3M以上，内存16G
  - 选择完成后，支付，完成购买

- 服务器的配置
  - 在云服务器上安装**BIM相关软件、插件**
  - 安装**IIS服务组件**，安装**SQL Server**以及**轻量化处理程序**
- 通过通信平台反馈到用户
  - Web服务器端软件的发送数据程序
  - 客户端的接受数据程序

> Web服务器端软件的发送数据程序主要负责接受客户端发来的Request请求读取数据命令，获取实时更新的数据平台的相关数据，将结果打包成数据包发送给用户。
>
> 在向用户发送的数据包中，数据包的内容采用的是JSON格式。JSON是JavaScript的对象表示法，它是一种轻量级的文本数据交换格式，数据格式比较简单且易于读写，占用宽带非常小，格式都是压缩的；它支持多种服务器端语言，便于服务器端的解析；众多的服务器对象、数组等能够直接生成JSON格式文件，对于客户端的提取接受都是很方便的，此外，客户端可以简单通过eval()进行JSON数据的读取与解析。

> 对于客户端，它的主要功能是获取服务器端实时发送过来的数据，通过解析显示在显示器上。
>
> 服务器端程序将数据平台内容编译成JSON格式的数据包，通过HTTP通信方式进行传输，HTTP通信使用的是一种“请求-响应”模式，客户端只有请求时才能建立链接，客户端每秒都发送请求。
>
> 客户端在获取完成服务器端发来的JSON数据包后，客户端程序开始对数据包的解析，将结果以规则的格式显示在显示器上。

---

- IIS服务组件的安装
  - 单击**服务器管理器**
  - 在**快速启动**子菜单下，单击**添加角色和功能**
  - 点击左边的**安装类型**，然后单击**基于角色或基于功能的安装**，再单击**下一步**
  - 先单击**从服务器池中选择服务器**，再单击**本服务器的计算机名**，这个ip上只有本机，所以直接单击**下一步(N)**
  - **服务器角色列表**内找到**Web服务器(IIS)**，单击勾选它
  - 弹出子对话框**添加角色和功能向导**，直接单击**添加功能**
  - 单击左边**功能**，中间勾选**.Net Framewore 3.5**
  - 再单击左边**角色服务**，中间角色服务列表选择需要安装的项目，全部都勾选[**Ftp服务器**除外]；
  - 安装前确认下所勾选的安装组件，然后单击**安装(I)**
  - 查看windows 2012 Server IIS8.0安装和运行结果
    - 打开Internet Explprer10浏览器，输入本机公网ip，或者本机内网ip，或localhost都可以，看到IIS8.0界面显示出来

---

- [x] sa

- SQL Server 2014的安装
  - 下载sql server2014安装包
    - 进入msdn i tell you: [https://msdn.itellyou.cn/](https://msdn.itellyou.cn/)，选择**SQL Server 2014**，选择第三个，打开后复制链接，在服务器上下载迅雷，使用迅雷下载
    - 输入产品密钥这一步，可以忽略，因为在msdn下载的是正版的软件，自带产品密钥，直接**确定**就ok
    - 安装方法参考此博文，[Blog1](https://blog.csdn.net/shenliang1985/article/details/79123121)，[Blog2](https://blog.csdn.net/shenliang1985/article/details/79123121)

## FAQ

- **数据传输具体流程？**

  - 传感器周期性取得采样数据（采样频率是1次/分钟），通过线缆与使用Modbus协议的网关连接；网关内部集成一个工业sim卡槽（mini sim卡）与4G全网通模块，在web网页上进行对其进行相应的配置，给出服务器的IP地址与数据库对应的端口号等信息，即可将采样数据传输到指定的数据库中；然后插件程序就可以使用期中的数据进行分析、预警。

- **预警原理？**

  - 预先输入监测点的预警值，当采样数据超出预警值时即报警（但是他这个实现的跟我们报告里的不一样，他这个是需要查看某个监测点时选择某个监测点，输入预警值，如果有哪个数据超过预警值就报警）

- **使用的数据库？**

  - Microsoft公司的`SQL Server（发音|'si,kol| + server）`，目前不支持其它类型