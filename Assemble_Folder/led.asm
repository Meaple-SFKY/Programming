.MODEL TINY

C8255 EQU 0273H

.MODEL TINY
ADDR_8255_PA EQU 270H
ADDR_8255_PB EQU 271H
ADDR_8255_PC EQU 272H
ADDR_8255_C EQU 273H
ADDR_8155_PA EQU 230H
ADDR_8155_C EQU 231H
LINE1 EQU ADDR_8255_PA
LINE2 EQU ADDR_8255_PB
ROW1 EQU ADDR_8255_PC
ROW2 EQU ADDR_8155_PA

.STACK 100

.DATA

JU
DB 00H,00H,3FH,F8H
DB 20H,00H,20H,00H
DB 20H,00H,3FH,F8H
DB 20H,08H,20H,08H
DB 20H,08H,3FH,F8H
DB 20H,00H,20H,00H
DB 20H,00H,3FH,F8H
DB 00H,00H,00H,00H
DB 00H,00H,00H,00H

; TODO
PAN
DB 

XU
DB 00H, 20H, 0CH, 60H
DB 18H, 50H, 20H, 98H
DB 4DH, 08H, 09H, 07H
DB 13H, F8H, 34H, 20H
DB 50H, 20H, 97H, FEH
DB 11H, 20H, 11H, 28H
DB 12H, 26H, 14H, 22H
DB 18H, A0H, 00H, 40H

.CODE
START:
		MOV AX,@DATA
		MOV DS,AX
		MOV ES,AX
		NOP
		CALL INIT_IO
		CALL TEST_LED ;调用测试子程序,测试 LED 是否全亮
		CALL CLEAR
		;滚动显示多个字符
		CHS_SHOW: MOV CX,5;一个循环显示 5 个字符(姓)
		LEA SI,HOU

CHS_1:
		PUSH CX
		MOV CX,16

CHS_2:
		CALL DISP_CH
		INC SI
		INC SI
		LOOP CHS_2
		POP CX
		LOOP CHS_1
		JMP CHS_SHOW
		;显示一个 16*16 点阵字子程序,字型码放在 DPTR 指出的地址

DISP_CH PROC NEAR
		PUSH CX
		MOV CX,8;延时显示字符
DISP_CH_1:
		CALL DISP1
		LOOP DISP_CH_1
		POP CX
		RET
DISP_CH ENDP

;显示一个 16*16 点阵字子程序,字型码放在显示缓冲区
XBUFF DISP1 PROC NEAR
		PUSH SI
		PUSH CX
		MOV CX,16 ;计数器,16 列依次被扫描
		MOV BL,0FEH ;上边列输出值
		MOV BH,0FFH ;下边列输出值
REPEAT: MOV DX,LINE1
		MOV AL,BL
		OUT DX,AL ;上边列输出
		MOV DX,LINE2
		MOV AL,BH
		OUT DX,AL ;下边列输出
		LODSB
		CALL ADJUST ;调整 AL,将 AL 中二进制数旋转 180 度
		MOV DX,ROW1
		OUT DX,AL ;左边行输出
		LODSB
		CALL ADJUST ;调整 AL,将 AL 中二进制数旋转 180 度
		MOV DX,ROW2
		OUT DX,AL ;右边行输出
		CALL DL10MS
		CALL CLEAR
		STC
		RCL BL,1
		RCL BH,1 ;循环移位 BX,行线扫描输出 0
		LOOP REPEAT
		POP CX
		POP SI
		RET
DISP1 ENDP

INIT_IO PROC NEAR
		MOV DX,ADDR_8255_C ;8255 控制字地址
		MOV AL,80H ;设置 8255 的 PA、PB、PC 口为输出口
		OUT DX,AL ;写控制字
		MOV DX,ADDR_8155_C ;8155 控制字地址
		MOV AL,03H ;设置 8155 的 PA 口为输出
		OUT DX,AL ;写控制字
		RET
INIT_IO ENDP



CLEAR PROC NEAR
	MOV AL,0FFH
	MOV DX,LINE1
	OUT DX,AL
	MOV DX,LINE2
	OUT DX,AL
	MOV AL,0
	MOV DX,ROW1
	OUT DX,AL
	MOV DX,ROW2
	OUT DX,AL
	RET
CLEAR ENDP

;测试 LED 子程序,点亮 LED 并延时 1S
TEST_LED PROC NEAR
		MOV DX,LINE1
		XOR AL,AL
		OUT DX,AL
		MOV DX,LINE2
		OUT DX,AL
		MOV AL,0FFH
		MOV DX,ROW1
		OUT DX,AL
		MOV DX,ROW2
		OUT DX,AL
		CALL DL500ms CALL DL500ms RET
TEST_LED ENDP

;调整 AL 中取到的字型码的一个字节,将最高位调整位最低位,最低位调整为最高位
ADJUST PROC NEAR
		PUSH CX
		MOV CX,8
ADJUST1:
		RCL AL,1
		XCHG AL,AH
		RCR AL,1
		XCHG AL,AH
		LOOP ADJUST1
		MOV AL,AH
		POP CX
		RET
ADJUST ENDP

DL10ms PROC NEAR
		PUSH CX
		MOV CX,133
		LOOP $
		POP CX
		RET
DL10ms ENDP

DL500ms PROC NEAR
		PUSH CX
		MOV CX,0FFFFH
		LOOP $
		POP CX
		RET
DL500ms ENDP

END START